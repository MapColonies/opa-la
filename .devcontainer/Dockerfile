FROM mcr.microsoft.com/devcontainers/base:ubuntu-24.04

RUN apt update && apt install -y \
    lsd \
    bat \
    ca-certificates \
    curl

# Create bat symlink - Generated by Copilot
RUN ln -s /usr/bin/batcat /usr/local/bin/bat

# Install Docker CLI - Generated by Copilot
RUN install -m 0755 -d /etc/apt/keyrings \
    && curl -fsSL https://download.docker.com/linux/ubuntu/gpg -o /etc/apt/keyrings/docker.asc \
    && chmod a+r /etc/apt/keyrings/docker.asc \
    && echo "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/ubuntu \
    $(. /etc/os-release && echo "${UBUNTU_CODENAME:-$VERSION_CODENAME}") stable" | \
    tee /etc/apt/sources.list.d/docker.list > /dev/null \
    && apt update \
    && apt install -y docker-ce-cli docker-buildx-plugin docker-compose-plugin

# Install kubectl - Generated by Copilot
RUN curl -LO "https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl" \
    && curl -LO "https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl.sha256" \
    && echo "$(cat kubectl.sha256)  kubectl" | sha256sum --check \
    && install -o root -g root -m 0755 kubectl /usr/local/bin/kubectl \
    && rm kubectl kubectl.sha256

# Install Helm - Generated by Copilot
RUN curl -fsSL -o get_helm.sh https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3 \
    && chmod 700 get_helm.sh \
    && ./get_helm.sh \
    && rm get_helm.sh

# Add docker group and vscode user to it - Generated by Copilot
RUN groupadd -g 999 docker && usermod -aG docker vscode

RUN sed -i 's|/home/vscode:/bin/bash|/home/vscode:/bin/zsh|g' /etc/passwd

USER vscode

RUN curl -sS https://starship.rs/install.sh | sh -s -- -y

# Install nvm and Node.js versions
RUN curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.40.3/install.sh | bash \
    && . "$HOME/.nvm/nvm.sh" \
    && export NVM_DIR="$HOME/.nvm" \
    && [ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh" \
    && [ -s "$NVM_DIR/bash_completion" ] && \. "$NVM_DIR/bash_completion" \
    && nvm install 20 \
    && nvm install 22 \
    && nvm install 24 \
    && nvm use 22 \
    && nvm alias default 22

# Copy terminal configuration files
COPY --chown=vscode:vscode terminal/starship.toml /home/vscode/.config/starship.toml
COPY --chown=vscode:vscode terminal/zshrc /home/vscode/.zshrc

# Create starship config directory if it doesn't exist
RUN mkdir -p /home/vscode/.config

ENV NVM_DIR="/home/vscode/.nvm"
ENV PATH="$NVM_DIR/versions/node/v22.17.0/bin:$PATH"
# Set environment variables
